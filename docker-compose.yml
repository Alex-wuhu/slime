services:
  slime:
    image: slime-backup:latest
    container_name: slime-dev

    deploy:
      resources:
        reservations:
          devices:
            - capabilities: ["gpu"]

    network_mode: bridge

    ports:
      - "127.0.0.1:9000:9000"

    ipc: private
    shm_size: 16g

    environment:
      - NVIDIA_VISIBLE_DEVICES=all

    working_dir: /workspace/slime

    volumes:
      - .:/workspace/slime
      - ./models:/root/models
      - slime-pip-cache:/root/.cache/pip
      - slime-checkpoints:/workspace/checkpoints

    command: |
      bash -lc 'pip install -e . &&
      ray stop --force || true &&
      ray start --head \
        --dashboard-host 127.0.0.1 \
        --dashboard-port 9000 \
        --disable-usage-stats &&
      sleep infinity'

    tty: true
    stdin_open: true
    restart: "no"

volumes:
  slime-pip-cache:
  slime-checkpoints:
